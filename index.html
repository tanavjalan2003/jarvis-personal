<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JARVIS — Voice Assistant</title>
  <style>
    :root{
      --bg:#07080a;
      --panel:#071226;
      --accent:#0096ff;
      --accent-2:#00c3ff;
      --muted:#97a6bf;
      --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 600px at 10% 20%, rgba(0,150,255,0.06), transparent),
                  linear-gradient(180deg,var(--bg), #031026 60%);
      color:#dbe8ff;
      display:flex;align-items:center;justify-content:center;
      padding:24px;
    }

    .shell{
      width:700px; max-width:98vw; min-height:400px; border-radius:18px; overflow:hidden;
      background: linear-gradient(180deg, rgba(9,20,36,0.6), rgba(3,6,12,0.6));
      box-shadow: 0 20px 50px rgba(2,6,14,0.7);
      display:flex; flex-direction:column; gap:20px; padding:18px;
      border:1px solid rgba(0,150,255,0.08);
      align-items:center;
    }

    .avatar{
      height:160px; width:100%; border-radius:12px; background:linear-gradient(120deg,var(--accent), var(--accent-2));
      display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;
      font-weight:700; font-size:22px; color:#001225;
      box-shadow: 0 6px 30px rgba(0,150,255,0.06) inset;
    }
    .avatar .glow{ position:absolute; inset:0; opacity:0.12; mix-blend-mode:screen }

    .status{display:flex; gap:10px; align-items:center; font-size:14px; color:var(--muted)}
    .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(180deg,#00ffea,#0077ff); box-shadow:0 0 12px rgba(0,150,255,0.45)}

    .wave{
      width:100%;height:80px;margin-top:8px;border-radius:8px;
      background:linear-gradient(90deg, rgba(0,150,255,0.04), transparent 30%);
      position:relative;overflow:hidden
    }
    .bars{position:absolute;bottom:0;left:0;right:0;display:flex;align-items:end;gap:4px;padding:8px}
    .bar{width:6px;height:8px;background:linear-gradient(180deg,var(--accent-2),var(--accent));border-radius:4px;opacity:0.9}

    .transcript{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;padding:14px;width:100%;height:150px;overflow:auto;
      border:1px solid rgba(0,150,255,0.04);font-size:14px;
    }

    .footer{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="shell" role="application" aria-label="Jarvis voice assistant UI">
    <div class="avatar" aria-hidden="true">
      <svg class="glow" viewBox="0 0 800 200" preserveAspectRatio="none" style="width:140%;height:140%;filter:blur(30px)">
        <defs>
          <linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#00c3ff"/><stop offset="1" stop-color="#0077ff"/></linearGradient>
        </defs>
        <rect x="-50" y="-50" width="900" height="400" fill="url(#g)"/>
      </svg>
      J A R V I S
    </div>

    <div class="status"><span class="dot"></span> Status: <span id="statusSmall">Starting...</span></div>

    <div class="wave" aria-hidden="true">
      <div class="bars" id="bars"></div>
    </div>

    <div class="transcript" id="transcript" aria-live="polite">
      <div>JARVIS ready. Listening...</div>
    </div>

    <div class="footer">Hands-free mode • Voice only • v2.0</div>
  </div>

<script>
const transcriptEl = document.getElementById('transcript');
const statusSmall = document.getElementById('statusSmall');
const bars = document.getElementById('bars');
let lastJarvisText = '';

function appendMessage(text){
  const div = document.createElement('div');
  div.textContent = text;
  transcriptEl.appendChild(div);
  transcriptEl.scrollTop = transcriptEl.scrollHeight;
}

function speak(text, opts={}){
  if(!('speechSynthesis' in window)) return;
  const u = new SpeechSynthesisUtterance(text);
  if(opts.lang) u.lang = opts.lang;
  if(opts.voice) u.voice = opts.voice;
  u.rate = opts.rate || 1;
  u.volume = opts.volume || 1;
  lastJarvisText = text;
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(u);
}

function handleCommand(raw){
  const cmd = raw.trim();
  const low = cmd.toLowerCase();
  statusSmall.textContent = 'Processing';
  console.log("Heard:", cmd);

  if(low==='help'){
    speak('I can tell the time, search the web, open websites, calculate, tell jokes, or change theme.');
    appendMessage('[Help] I can tell time, search, open websites, calculate, tell jokes, change theme.');
    statusSmall.textContent = 'Listening';
    return;
  }

  if(/time/.test(low)){
    const t = new Date().toLocaleTimeString();
    speak('The time is ' + t);
    appendMessage('The time is ' + t);
    statusSmall.textContent = 'Listening';
    return;
  }

  if(low.startsWith('search for ')){
    const q = cmd.slice(11);
    speak('Searching for ' + q);
    window.open('https://www.google.com/search?q=' + encodeURIComponent(q), '_blank');
    appendMessage('Searching for: ' + q);
    statusSmall.textContent = 'Listening';
    return;
  }

  if(low.startsWith('open ')){
    let url = cmd.slice(5).trim();
    if(!/^https?:\/\//i.test(url)) url = 'https://' + url;
    speak('Opening ' + url);
    window.open(url, '_blank');
    appendMessage('Opened: ' + url);
    statusSmall.textContent = 'Listening';
    return;
  }

  if(low.startsWith('calculate ') || /^(calc|compute) /.test(low)){
    const expr = cmd.replace(/^(calculate|calc|compute)\s+/i, '');
    try{
      if(!/^[0-9+\-*/(). %^]+$/.test(expr.replace(/\s+/g,''))) throw new Error('unsafe');
      const safeExpr = expr.replace(/\^/g,'**');
      const result = Function('return ('+safeExpr+')')();
      speak('The result is ' + result);
      appendMessage(expr + ' = ' + result);
    }catch(e){
      speak('I could not calculate that.');
      appendMessage('Could not calculate.');
    }
    statusSmall.textContent = 'Listening';
    return;
  }

  if(low==='joke'){
    const jokes = [
      "Why do programmers prefer dark mode? Because light attracts bugs.",
      "I told my computer I needed a break — it said 'no problem, I'll go to sleep.'",
      "Why did the developer go broke? Because he used up all his cache."
    ];
    const j = jokes[Math.floor(Math.random()*jokes.length)];
    speak(j);
    appendMessage(j);
    statusSmall.textContent = 'Listening';
    return;
  }

  speak("Sorry, I didn't understand that.");
  appendMessage('Unrecognized command: ' + cmd);
  statusSmall.textContent = 'Listening';
}

// Visualizer bars
function makeBars(n=28){
  bars.innerHTML='';
  for(let i=0;i<n;i++){
    const b=document.createElement('div');
    b.className='bar';
    b.style.height = (8 + Math.random()*48) + 'px';
    bars.appendChild(b);
  }
}
makeBars();
setInterval(()=>{
  document.querySelectorAll('.bar').forEach(b=>{
    b.style.height = (8 + Math.random()*48) + 'px';
  });
}, 350);

// Speech recognition setup
let recognition = null;
let recognizing = false;

try{
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(SpeechRecognition){
    recognition = new SpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = false;
    recognition.lang = 'en-US';

    recognition.onstart = ()=>{
      recognizing=true;
      statusSmall.textContent='Listening';
    }
    recognition.onend = ()=>{
      recognizing=false;
      setTimeout(()=> recognition.start(), 500); // auto-restart
    }
    recognition.onresult = (ev)=>{
      const t = ev.results[0][0].transcript;
      handleCommand(t);
    }
    recognition.onerror = (ev)=>{
      console.error('Speech error', ev);
      appendMessage('Voice error: '+ev.error);
    }
  } else {
    appendMessage('Speech recognition not supported in your browser.');
  }
}catch(e){
  appendMessage('Speech recognition init failed.');
}

// Auto-start listening
window.addEventListener('load', ()=>{
  if(recognition){
    recognition.start();
    speak('Jarvis online. Listening.');
  }
});
</script>
</body>
</html>
